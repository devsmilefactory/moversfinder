import React from 'react';\nimport ProfileFormContainer from '../containers/ProfileFormContainer';\nimport { PersonalInfoStep, DocumentsStep, BankingStep } from '../steps';\nimport { StepNavigation } from '../../shared/forms';\nimport { FormInput, FormSelect } from '../../shared/forms';\nimport useAuthStore from '../../../stores/authStore';\nimport Icon from '../../ui/AppIcon';\n\n/**\n * RefactoredCorporateProfileForm Component\n * \n * Refactored corporate profile form using the new modular infrastructure.\n * Handles company information, billing methods, and service selection.\n */\nconst RefactoredCorporateProfileForm = ({ onComplete, canDismiss }) => {\n  const user = useAuthStore((state) => state.user);\n\n  const initialData = {\n    company_name: '',\n    company_size: '',\n    business_registration: '',\n    company_address: '',\n    billing_method: [],\n    selected_services: [],\n    // Personal contact info\n    full_name: user?.name || '',\n    phone: user?.phone || '',\n    email: user?.email || '',\n    // Banking\n    bank_name: '',\n    account_number: '',\n    account_holder_name: ''\n  };\n\n  const validationRules = {\n    1: [\n      {\n        field: 'company_name',\n        required: true,\n        message: 'Company name is required'\n      },\n      {\n        field: 'company_size',\n        required: true,\n        message: 'Company size is required'\n      },\n      {\n        field: 'business_registration',\n        required: true,\n        message: 'Business registration number is required'\n      },\n      {\n        field: 'company_address',\n        required: true,\n        message: 'Company address is required'\n      }\n    ],\n    2: [\n      {\n        field: 'full_name',\n        required: true,\n        message: 'Contact person name is required'\n      },\n      {\n        field: 'phone',\n        required: true,\n        message: 'Phone number is required'\n      },\n      {\n        field: 'email',\n        required: true,\n        message: 'Email address is required'\n      }\n    ],\n    3: [\n      {\n        field: 'billing_method',\n        required: true,\n        validator: (value) => Array.isArray(value) && value.length > 0,\n        message: 'At least one billing method is required'\n      },\n      {\n        field: 'selected_services',\n        required: true,\n        validator: (value) => Array.isArray(value) && value.length > 0,\n        message: 'At least one service type is required'\n      }\n    ]\n  };\n\n  const stepLabels = [\n    'Company Info',\n    'Contact Details', \n    'Services & Billing'\n  ];\n\n  const COMPANY_SIZES = [\n    { value: '1-10', label: '1-10 employees' },\n    { value: '11-50', label: '11-50 employees' },\n    { value: '51-200', label: '51-200 employees' },\n    { value: '201-500', label: '201-500 employees' },\n    { value: '500+', label: '500+ employees' },\n  ];\n\n  const BILLING_METHODS = [\n    {\n      value: 'prepaid_credits',\n      label: 'Prepaid Credits',\n      description: 'Load credits in advance, use as needed',\n      icon: 'CreditCard',\n      requiresApproval: false\n    },\n    {\n      value: 'cash',\n      label: 'Cash Payment',\n      description: 'Pay cash for each trip',\n      icon: 'Banknote',\n      requiresApproval: false\n    },\n    {\n      value: 'credit_account',\n      label: 'Credit Account',\n      description: 'Book now, pay later (requires approval)',\n      icon: 'FileText',\n      requiresApproval: true\n    },\n  ];\n\n  const SERVICE_TYPES = [\n    { \n      id: 'pre-booked', \n      label: 'Pre-Booked Rides',\n      description: 'Schedule rides in advance',\n      icon: 'Calendar'\n    },\n    { \n      id: 'staff-transport', \n      label: 'Staff Transportation',\n      description: 'Daily commute for employees',\n      icon: 'Users'\n    },\n    { \n      id: 'recurring', \n      label: 'Recurring Trips',\n      description: 'Regular scheduled trips',\n      icon: 'Repeat'\n    },\n    { \n      id: 'on-demand', \n      label: 'On-Demand Rides',\n      description: 'Instant ride requests',\n      icon: 'Zap'\n    },\n  ];\n\n  const CompanyInfoStep = ({ formData, errors, onChange }) => (\n    <div className=\"space-y-6\">\n      <div className=\"text-center space-y-2\">\n        <div className=\"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n          <Icon name=\"Building\" className=\"w-6 h-6 text-blue-600\" />\n        </div>\n        <h2 className=\"text-xl font-semibold text-gray-900\">\n          Company Information\n        </h2>\n        <p className=\"text-sm text-gray-600\">\n          Tell us about your company\n        </p>\n      </div>\n\n      <div className=\"space-y-4\">\n        <FormInput\n          label=\"Company Name\"\n          name=\"company_name\"\n          value={formData.company_name || ''}\n          onChange={(value) => onChange('company_name', value)}\n          error={errors.company_name}\n          required\n          placeholder=\"Acme Corporation\"\n        />\n        \n        <FormSelect\n          label=\"Company Size\"\n          name=\"company_size\"\n          value={formData.company_size || ''}\n          onChange={(value) => onChange('company_size', value)}\n          options={COMPANY_SIZES}\n          error={errors.company_size}\n          required\n          placeholder=\"Select company size\"\n        />\n        \n        <FormInput\n          label=\"Business Registration Number\"\n          name=\"business_registration\"\n          value={formData.business_registration || ''}\n          onChange={(value) => onChange('business_registration', value)}\n          error={errors.business_registration}\n          required\n          placeholder=\"REG/2023/12345\"\n        />\n        \n        <FormInput\n          label=\"Company Address\"\n          name=\"company_address\"\n          value={formData.company_address || ''}\n          onChange={(value) => onChange('company_address', value)}\n          error={errors.company_address}\n          required\n          placeholder=\"123 Business Street, Harare\"\n        />\n      </div>\n    </div>\n  );\n\n  const ServicesAndBillingStep = ({ formData, errors, onChange }) => {\n    const toggleBillingMethod = (methodValue) => {\n      const currentMethods = formData.billing_method || [];\n      const newMethods = currentMethods.includes(methodValue)\n        ? currentMethods.filter(m => m !== methodValue)\n        : [...currentMethods, methodValue];\n      onChange('billing_method', newMethods);\n    };\n\n    const toggleService = (serviceId) => {\n      const currentServices = formData.selected_services || [];\n      const newServices = currentServices.includes(serviceId)\n        ? currentServices.filter(s => s !== serviceId)\n        : [...currentServices, serviceId];\n      onChange('selected_services', newServices);\n    };\n\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"text-center space-y-2\">\n          <div className=\"mx-auto w-12 h-12 bg-green-100 rounded-full flex items-center justify-center\">\n            <Icon name=\"CreditCard\" className=\"w-6 h-6 text-green-600\" />\n          </div>\n          <h2 className=\"text-xl font-semibold text-gray-900\">\n            Services & Billing\n          </h2>\n          <p className=\"text-sm text-gray-600\">\n            Choose your services and billing preferences\n          </p>\n        </div>\n\n        {/* Service Selection */}\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-medium text-gray-900\">Select Services</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {SERVICE_TYPES.map(service => (\n              <div\n                key={service.id}\n                className={`border-2 rounded-lg p-4 cursor-pointer transition-colors ${\n                  (formData.selected_services || []).includes(service.id)\n                    ? 'border-blue-500 bg-blue-50'\n                    : 'border-gray-200 hover:border-gray-300'\n                }`}\n                onClick={() => toggleService(service.id)}\n              >\n                <div className=\"flex items-start gap-3\">\n                  <Icon name={service.icon} className=\"w-5 h-5 text-gray-600 mt-1\" />\n                  <div>\n                    <h4 className=\"font-medium text-gray-900\">{service.label}</h4>\n                    <p className=\"text-sm text-gray-600 mt-1\">{service.description}</p>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n          {errors.selected_services && (\n            <p className=\"text-sm text-red-600\">{errors.selected_services}</p>\n          )}\n        </div>\n\n        {/* Billing Methods */}\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-medium text-gray-900\">Billing Methods</h3>\n          <div className=\"space-y-3\">\n            {BILLING_METHODS.map(method => (\n              <div\n                key={method.value}\n                className={`border-2 rounded-lg p-4 cursor-pointer transition-colors ${\n                  (formData.billing_method || []).includes(method.value)\n                    ? 'border-green-500 bg-green-50'\n                    : 'border-gray-200 hover:border-gray-300'\n                }`}\n                onClick={() => toggleBillingMethod(method.value)}\n              >\n                <div className=\"flex items-start gap-3\">\n                  <Icon name={method.icon} className=\"w-5 h-5 text-gray-600 mt-1\" />\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <h4 className=\"font-medium text-gray-900\">{method.label}</h4>\n                      {method.requiresApproval && (\n                        <span className=\"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded\">\n                          Requires Approval\n                        </span>\n                      )}\n                    </div>\n                    <p className=\"text-sm text-gray-600 mt-1\">{method.description}</p>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n          {errors.billing_method && (\n            <p className=\"text-sm text-red-600\">{errors.billing_method}</p>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <ProfileFormContainer\n      profileType=\"corporate\"\n      totalSteps={3}\n      initialData={initialData}\n      onComplete={onComplete}\n      className=\"max-w-3xl mx-auto\"\n    >\n      {({\n        currentStep,\n        totalSteps,\n        formData,\n        errors,\n        handleInputChange,\n        handleNext,\n        handleBack,\n        saveProgress,\n        handleSubmit,\n        saving,\n        savingProgress\n      }) => (\n        <div className=\"space-y-6\">\n          {/* Step Navigation */}\n          <StepNavigation\n            currentStep={currentStep}\n            totalSteps={totalSteps}\n            stepLabels={stepLabels}\n            onNext={() => handleNext(validationRules)}\n            onPrevious={handleBack}\n            canGoNext={true}\n            canGoBack={currentStep > 1}\n            isLastStep={currentStep === totalSteps}\n            loading={saving}\n            showProgress={true}\n          />\n\n          {/* Step Content */}\n          <div className=\"min-h-[400px]\">\n            {/* Step 1: Company Information */}\n            {currentStep === 1 && (\n              <CompanyInfoStep\n                formData={formData}\n                errors={errors}\n                onChange={handleInputChange}\n              />\n            )}\n\n            {/* Step 2: Contact Details */}\n            {currentStep === 2 && (\n              <PersonalInfoStep\n                formData={formData}\n                errors={errors}\n                onChange={handleInputChange}\n                profileType=\"corporate\"\n              />\n            )}\n\n            {/* Step 3: Services & Billing */}\n            {currentStep === 3 && (\n              <ServicesAndBillingStep\n                formData={formData}\n                errors={errors}\n                onChange={handleInputChange}\n              />\n            )}\n          </div>\n\n          {/* Save Progress Button */}\n          <div className=\"flex justify-center pt-4 border-t border-gray-200\">\n            <button\n              onClick={() => saveProgress()}\n              disabled={savingProgress || saving}\n              className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\"\n            >\n              {savingProgress ? 'Saving...' : 'Save Progress'}\n            </button>\n          </div>\n\n          {/* Form Submission */}\n          {currentStep === totalSteps && (\n            <div className=\"text-center pt-4\">\n              <button\n                onClick={() => handleSubmit()}\n                disabled={saving}\n                className=\"px-6 py-3 text-base font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\"\n              >\n                {saving ? 'Submitting...' : 'Complete Corporate Profile'}\n              </button>\n              \n              <p className=\"text-xs text-gray-500 mt-2\">\n                Your corporate profile will be reviewed within 24-48 hours\n              </p>\n            </div>\n          )}\n        </div>\n      )}\n    </ProfileFormContainer>\n  );\n};\n\nexport default RefactoredCorporateProfileForm;"