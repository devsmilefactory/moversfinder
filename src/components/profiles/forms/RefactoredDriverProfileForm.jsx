import React from 'react';\nimport ProfileFormContainer from '../containers/ProfileFormContainer';\nimport { PersonalInfoStep, LicenseInfoStep, VehicleInfoStep, DocumentsStep, BankingStep } from '../steps';\nimport { StepNavigation } from '../../shared/forms';\nimport useAuthStore from '../../../stores/authStore';\nimport DriverOperatorMatching from '../../auth/DriverOperatorMatching';\n\n/**\n * RefactoredDriverProfileForm Component\n * \n * Refactored driver profile form using the new modular infrastructure.\n * Maintains all original functionality while improving maintainability.\n */\nconst RefactoredDriverProfileForm = ({ onComplete }) => {\n  const user = useAuthStore((state) => state.user);\n\n  const initialData = {\n    // Operator Association\n    operator_id: '',\n    operator_approval_status: 'pending',\n    \n    // Personal Information\n    full_name: user?.name || '',\n    date_of_birth: '',\n    national_id: '',\n    \n    // Driver's License\n    license_number: '',\n    license_expiry: '',\n    license_class: '',\n    license_document: null,\n    \n    // Vehicle Information\n    vehicle_make: '',\n    vehicle_model: '',\n    vehicle_year: '',\n    vehicle_color: '',\n    license_plate: '',\n    vehicle_photo: null,\n    \n    // Vehicle Documents\n    vehicle_registration: null,\n    insurance_certificate: null,\n    roadworthy_certificate: null,\n    \n    // Banking Information\n    bank_name: '',\n    account_number: '',\n    account_holder_name: '',\n  };\n\n  const validationRules = {\n    1: [\n      {\n        field: 'license_plate',\n        required: true,\n        message: 'License plate is required for conflict checking'\n      }\n    ],\n    2: [\n      {\n        field: 'full_name',\n        required: true,\n        message: 'Full name is required'\n      },\n      {\n        field: 'date_of_birth',\n        required: true,\n        message: 'Date of birth is required'\n      },\n      {\n        field: 'national_id',\n        required: true,\n        message: 'National ID is required'\n      }\n    ],\n    3: [\n      {\n        field: 'license_number',\n        required: true,\n        message: 'License number is required'\n      },\n      {\n        field: 'license_expiry',\n        required: true,\n        message: 'License expiry date is required'\n      },\n      {\n        field: 'license_class',\n        required: true,\n        message: 'License class is required'\n      },\n      {\n        field: 'license_document',\n        required: true,\n        message: 'License document is required'\n      }\n    ],\n    4: [\n      {\n        field: 'vehicle_make',\n        required: true,\n        message: 'Vehicle make is required'\n      },\n      {\n        field: 'vehicle_model',\n        required: true,\n        message: 'Vehicle model is required'\n      },\n      {\n        field: 'vehicle_year',\n        required: true,\n        message: 'Vehicle year is required'\n      },\n      {\n        field: 'vehicle_color',\n        required: true,\n        message: 'Vehicle color is required'\n      },\n      {\n        field: 'vehicle_photo',\n        required: true,\n        message: 'Vehicle photo is required'\n      },\n      {\n        field: 'vehicle_registration',\n        required: true,\n        message: 'Vehicle registration is required'\n      },\n      {\n        field: 'insurance_certificate',\n        required: true,\n        message: 'Insurance certificate is required'\n      },\n      {\n        field: 'roadworthy_certificate',\n        required: true,\n        message: 'Roadworthy certificate is required'\n      }\n    ],\n    5: [\n      {\n        field: 'bank_name',\n        required: true,\n        message: 'Bank name is required'\n      },\n      {\n        field: 'account_number',\n        required: true,\n        message: 'Account number is required'\n      },\n      {\n        field: 'account_holder_name',\n        required: true,\n        message: 'Account holder name is required'\n      }\n    ]\n  };\n\n  const stepLabels = [\n    'Operator Matching',\n    'Personal Info',\n    'License Info',\n    'Vehicle & Documents',\n    'Banking Info'\n  ];\n\n  const uploadFiles = [\n    { fieldName: 'license_document', bucket: 'documents' },\n    { fieldName: 'vehicle_photo', bucket: 'documents' },\n    { fieldName: 'vehicle_registration', bucket: 'documents' },\n    { fieldName: 'insurance_certificate', bucket: 'documents' },\n    { fieldName: 'roadworthy_certificate', bucket: 'documents' }\n  ];\n\n  const handleComplete = () => {\n    onComplete?.();\n  };\n\n  const handleStepChange = (newStep) => {\n    // Handle any step-specific logic here\n  };\n\n  return (\n    <ProfileFormContainer\n      profileType=\"driver\"\n      totalSteps={5}\n      initialData={initialData}\n      onComplete={handleComplete}\n      onStepChange={handleStepChange}\n      className=\"max-w-4xl mx-auto\"\n    >\n      {({\n        currentStep,\n        totalSteps,\n        formData,\n        errors,\n        handleInputChange,\n        handleFileChange,\n        handleNext,\n        handleBack,\n        saveProgress,\n        handleSubmit,\n        validateStep,\n        saving,\n        savingProgress\n      }) => (\n        <div className=\"space-y-6\">\n          {/* Step Navigation */}\n          <StepNavigation\n            currentStep={currentStep}\n            totalSteps={totalSteps}\n            stepLabels={stepLabels}\n            onNext={() => handleNext(validationRules)}\n            onPrevious={handleBack}\n            canGoNext={true}\n            canGoBack={currentStep > 1}\n            isLastStep={currentStep === totalSteps}\n            loading={saving}\n            showProgress={true}\n          />\n\n          {/* Step Content */}\n          <div className=\"min-h-[500px]\">\n            {/* Step 1: Operator Matching */}\n            {currentStep === 1 && (\n              <div className=\"space-y-6\">\n                <div className=\"text-center space-y-2\">\n                  <h2 className=\"text-xl font-semibold text-gray-900\">\n                    Operator Association\n                  </h2>\n                  <p className=\"text-sm text-gray-600\">\n                    Select a taxi operator or proceed independently\n                  </p>\n                </div>\n                \n                <DriverOperatorMatching \n                  formData={formData}\n                  setFormData={(updates) => {\n                    Object.entries(updates).forEach(([key, value]) => {\n                      handleInputChange(key, value);\n                    });\n                  }}\n                  errors={errors}\n                  setErrors={() => {}} // Handled by container\n                />\n              </div>\n            )}\n\n            {/* Step 2: Personal Information */}\n            {currentStep === 2 && (\n              <PersonalInfoStep\n                formData={formData}\n                errors={errors}\n                onChange={handleInputChange}\n                profileType=\"driver\"\n              />\n            )}\n\n            {/* Step 3: License Information */}\n            {currentStep === 3 && (\n              <LicenseInfoStep\n                formData={formData}\n                errors={errors}\n                onChange={handleInputChange}\n                onFileChange={handleFileChange}\n              />\n            )}\n\n            {/* Step 4: Vehicle Information & Documents */}\n            {currentStep === 4 && (\n              <div className=\"space-y-8\">\n                <VehicleInfoStep\n                  formData={formData}\n                  errors={errors}\n                  onChange={handleInputChange}\n                  onFileChange={handleFileChange}\n                />\n                \n                <div className=\"border-t border-gray-200 pt-6\">\n                  <DocumentsStep\n                    formData={formData}\n                    errors={errors}\n                    onFileChange={handleFileChange}\n                    profileType=\"driver\"\n                  />\n                </div>\n              </div>\n            )}\n\n            {/* Step 5: Banking Information */}\n            {currentStep === 5 && (\n              <BankingStep\n                formData={formData}\n                errors={errors}\n                onChange={handleInputChange}\n                profileType=\"driver\"\n              />\n            )}\n          </div>\n\n          {/* Save Progress Button */}\n          <div className=\"flex justify-center pt-4 border-t border-gray-200\">\n            <button\n              onClick={() => saveProgress()}\n              disabled={savingProgress || saving}\n              className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\"\n            >\n              {savingProgress ? 'Saving...' : 'Save Progress'}\n            </button>\n          </div>\n\n          {/* Form Submission */}\n          {currentStep === totalSteps && (\n            <div className=\"text-center pt-4\">\n              <button\n                onClick={() => handleSubmit({}, uploadFiles)}\n                disabled={saving}\n                className=\"px-6 py-3 text-base font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50\"\n              >\n                {saving ? 'Submitting...' : 'Submit for Verification'}\n              </button>\n              \n              <p className=\"text-xs text-gray-500 mt-2\">\n                {formData.operator_id\n                  ? 'Your profile will be reviewed by the operator and BMTOA within 24-48 hours'\n                  : 'Your profile will be reviewed by BMTOA within 24-48 hours'\n                }\n              </p>\n            </div>\n          )}\n        </div>\n      )}\n    </ProfileFormContainer>\n  );\n};\n\nexport default RefactoredDriverProfileForm;"