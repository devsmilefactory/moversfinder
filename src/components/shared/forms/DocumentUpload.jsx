import React, { useState, useRef } from 'react';\nimport { Upload, FileText, Image, X, CheckCircle, AlertCircle } from 'lucide-react';\nimport Button from '../../ui/Button';\n\n/**\n * DocumentUpload Component\n * \n * Handles file upload functionality with drag and drop support,\n * file validation, preview, and error handling.\n */\nconst DocumentUpload = ({\n  label,\n  description,\n  required = false,\n  accept = 'image/*,.pdf',\n  maxSize = 5 * 1024 * 1024, // 5MB\n  file,\n  error,\n  onChange,\n  onRemove,\n  disabled = false,\n  showPreview = true,\n  allowReplace = true,\n  uploadProgress,\n  className = ''\n}) => {\n  const [isDragOver, setIsDragOver] = useState(false);\n  const [preview, setPreview] = useState(null);\n  const fileInputRef = useRef(null);\n\n  const handleFileSelect = (selectedFile) => {\n    if (!selectedFile) return;\n\n    const validation = validateFile(selectedFile);\n    if (!validation.isValid) {\n      onChange?.(null, validation.error);\n      return;\n    }\n\n    if (selectedFile.type.startsWith('image/') && showPreview) {\n      const reader = new FileReader();\n      reader.onload = (e) => setPreview(e.target.result);\n      reader.readAsDataURL(selectedFile);\n    } else {\n      setPreview(null);\n    }\n\n    onChange?.(selectedFile);\n  };\n\n  const validateFile = (file) => {\n    if (!file) {\n      return { isValid: false, error: 'No file selected' };\n    }\n\n    if (file.size > maxSize) {\n      return {\n        isValid: false,\n        error: `File size must be less than ${formatFileSize(maxSize)}`\n      };\n    }\n\n    const acceptedTypes = accept.split(',').map(type => type.trim());\n    const isValidType = acceptedTypes.some(type => {\n      if (type.startsWith('.')) {\n        return file.name.toLowerCase().endsWith(type.toLowerCase());\n      }\n      return file.type.match(type.replace('*', '.*'));\n    });\n\n    if (!isValidType) {\n      return {\n        isValid: false,\n        error: `File type not supported. Accepted: ${accept}`\n      };\n    }\n\n    return { isValid: true };\n  };\n\n  const formatFileSize = (bytes) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    if (!disabled) {\n      setIsDragOver(true);\n    }\n  };\n\n  const handleDragLeave = (e) => {\n    e.preventDefault();\n    setIsDragOver(false);\n  };\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    setIsDragOver(false);\n    \n    if (disabled) return;\n    \n    const droppedFile = e.dataTransfer.files[0];\n    if (droppedFile) {\n      handleFileSelect(droppedFile);\n    }\n  };\n\n  const handleInputChange = (e) => {\n    const selectedFile = e.target.files[0];\n    handleFileSelect(selectedFile);\n    e.target.value = '';\n  };\n\n  const handleRemoveFile = () => {\n    setPreview(null);\n    onRemove?.();\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const openFileDialog = () => {\n    if (!disabled && fileInputRef.current) {\n      fileInputRef.current.click();\n    }\n  };\n\n  const hasFile = !!file;\n  const hasError = !!error;\n  const isUploading = uploadProgress !== undefined && uploadProgress < 100;\n  const isUploaded = uploadProgress === 100;\n\n  return (\n    <div className={`space-y-2 ${className}`}>\n      {label && (\n        <label className=\"block text-sm font-medium text-gray-700\">\n          {label}\n          {required && <span className=\"text-red-500 ml-1\">*</span>}\n        </label>\n      )}\n      \n      {description && (\n        <p className=\"text-sm text-gray-600\">{description}</p>\n      )}\n\n      <div\n        className={`relative border-2 border-dashed rounded-lg transition-colors ${\n          isDragOver\n            ? 'border-blue-400 bg-blue-50'\n            : hasError\n            ? 'border-red-300 bg-red-50'\n            : hasFile\n            ? 'border-green-300 bg-green-50'\n            : 'border-gray-300 bg-gray-50'\n        } ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer hover:border-gray-400'}`}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n        onClick={!hasFile || allowReplace ? openFileDialog : undefined}\n      >\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept={accept}\n          onChange={handleInputChange}\n          disabled={disabled}\n          className=\"sr-only\"\n        />\n\n        {isUploading && (\n          <div className=\"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg\">\n            <div className=\"text-center space-y-2\">\n              <div className=\"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto\" />\n              <p className=\"text-sm text-blue-600 font-medium\">\n                Uploading... {Math.round(uploadProgress)}%\n              </p>\n            </div>\n          </div>\n        )}\n\n        <div className=\"p-6\">\n          {hasFile ? (\n            <div className=\"space-y-4\">\n              {preview && (\n                <div className=\"flex justify-center\">\n                  <img\n                    src={preview}\n                    alt=\"Preview\"\n                    className=\"max-w-32 max-h-32 object-cover rounded-lg border border-gray-200\"\n                  />\n                </div>\n              )}\n              \n              <div className=\"flex items-center justify-center gap-3\">\n                {file.type.startsWith('image/') ? (\n                  <Image className=\"w-8 h-8 text-gray-600\" />\n                ) : (\n                  <FileText className=\"w-8 h-8 text-gray-600\" />\n                )}\n                <div className=\"text-center\">\n                  <p className=\"text-sm font-medium text-gray-900 truncate max-w-48\">\n                    {file.name}\n                  </p>\n                  <p className=\"text-xs text-gray-500\">\n                    {formatFileSize(file.size)}\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex items-center justify-center gap-2\">\n                {isUploaded ? (\n                  <div className=\"flex items-center gap-1 text-green-600\">\n                    <CheckCircle className=\"w-4 h-4\" />\n                    <span className=\"text-sm font-medium\">Uploaded</span>\n                  </div>\n                ) : hasError ? (\n                  <div className=\"flex items-center gap-1 text-red-600\">\n                    <AlertCircle className=\"w-4 h-4\" />\n                    <span className=\"text-sm font-medium\">Error</span>\n                  </div>\n                ) : (\n                  <div className=\"flex items-center gap-1 text-blue-600\">\n                    <CheckCircle className=\"w-4 h-4\" />\n                    <span className=\"text-sm font-medium\">Ready</span>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex items-center justify-center gap-2\">\n                {allowReplace && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      openFileDialog();\n                    }}\n                    disabled={disabled || isUploading}\n                  >\n                    <Upload className=\"w-3 h-3 mr-1\" />\n                    Replace\n                  </Button>\n                )}\n                \n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleRemoveFile();\n                  }}\n                  disabled={disabled || isUploading}\n                  className=\"text-red-600 hover:text-red-700\"\n                >\n                  <X className=\"w-3 h-3 mr-1\" />\n                  Remove\n                </Button>\n              </div>\n            </div>\n          ) : (\n            <div className=\"text-center space-y-4\">\n              <Upload className=\"mx-auto h-12 w-12 text-gray-400\" />\n              \n              <div className=\"space-y-2\">\n                <p className=\"text-sm font-medium text-gray-900\">\n                  {isDragOver ? 'Drop file here' : 'Click to upload or drag and drop'}\n                </p>\n                <p className=\"text-xs text-gray-500\">\n                  {accept.includes('image') && 'Images: JPG, PNG, GIF'}\n                  {accept.includes('pdf') && (accept.includes('image') ? ' • ' : '') + 'Documents: PDF'}\n                  <br />\n                  Max size: {formatFileSize(maxSize)}\n                </p>\n              </div>\n              \n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                disabled={disabled}\n                onClick={(e) => e.stopPropagation()}\n              >\n                <Upload className=\"w-4 h-4 mr-2\" />\n                Choose File\n              </Button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {error && (\n        <div className=\"flex items-center gap-2 text-sm text-red-600\">\n          <AlertCircle className=\"w-4 h-4 flex-shrink-0\" />\n          <span>{error}</span>\n        </div>\n      )}\n\n      {!error && (\n        <div className=\"text-xs text-gray-500\">\n          <p>• Ensure the document is clear and all text is readable</p>\n          <p>• File will be securely encrypted and stored</p>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default DocumentUpload;"