import { useState, useCallback, useMemo } from 'react';\nimport { format, addDays, startOfMonth, endOfMonth, eachDayOfInterval, isWeekend } from 'date-fns';\n\n/**\n * useScheduling Hook\n * Manages scheduling functionality for booking forms including date selection and time management\n */\nconst useScheduling = ({\n  initialScheduleType = 'instant',\n  maxFutureDays = 90,\n  minAdvanceHours = 1\n} = {}) => {\n  // Scheduling state\n  const [scheduleType, setScheduleType] = useState(initialScheduleType);\n  const [selectedDates, setSelectedDates] = useState([]);\n  const [scheduleMonth, setScheduleMonth] = useState('');\n  const [tripTime, setTripTime] = useState('');\n  const [isRecurring, setIsRecurring] = useState(false);\n  \n  // Get available time slots\n  const getAvailableTimeSlots = useCallback(() => {\n    const slots = [];\n    const now = new Date();\n    const currentHour = now.getHours();\n    const currentMinute = now.getMinutes();\n    \n    // Generate time slots from 6 AM to 11 PM in 30-minute intervals\n    for (let hour = 6; hour <= 23; hour++) {\n      for (let minute = 0; minute < 60; minute += 30) {\n        // Skip past times for today\n        const slotTime = new Date();\n        slotTime.setHours(hour, minute, 0, 0);\n        \n        if (slotTime > new Date(now.getTime() + minAdvanceHours * 60 * 60 * 1000)) {\n          const timeString = format(slotTime, 'HH:mm');\n          const displayString = format(slotTime, 'h:mm a');\n          slots.push({ value: timeString, label: displayString });\n        }\n      }\n    }\n    \n    return slots;\n  }, [minAdvanceHours]);\n  \n  // Get available dates\n  const getAvailableDates = useCallback(() => {\n    const today = new Date();\n    const maxDate = addDays(today, maxFutureDays);\n    \n    return eachDayOfInterval({ start: today, end: maxDate });\n  }, [maxFutureDays]);\n  \n  // Get weekdays in a month\n  const getWeekdaysInMonth = useCallback((monthString) => {\n    if (!monthString) return [];\n    \n    const [year, month] = monthString.split('-').map(Number);\n    const start = startOfMonth(new Date(year, month - 1));\n    const end = endOfMonth(new Date(year, month - 1));\n    \n    return eachDayOfInterval({ start, end }).filter(date => !isWeekend(date));\n  }, []);\n  \n  // Get weekends in a month\n  const getWeekendsInMonth = useCallback((monthString) => {\n    if (!monthString) return [];\n    \n    const [year, month] = monthString.split('-').map(Number);\n    const start = startOfMonth(new Date(year, month - 1));\n    const end = endOfMonth(new Date(year, month - 1));\n    \n    return eachDayOfInterval({ start, end }).filter(date => isWeekend(date));\n  }, []);\n  \n  // Handle schedule type change\n  const handleScheduleTypeChange = useCallback((newType) => {\n    setScheduleType(newType);\n    \n    // Reset related state when changing types\n    if (newType === 'instant') {\n      setSelectedDates([]);\n      setScheduleMonth('');\n      setTripTime('');\n      setIsRecurring(false);\n    } else if (newType === 'specific_time') {\n      setSelectedDates([]);\n      setScheduleMonth('');\n      setIsRecurring(false);\n    } else if (newType === 'specific_dates') {\n      setScheduleMonth('');\n      setTripTime('');\n      setIsRecurring(false);\n    } else if (newType === 'weekdays' || newType === 'weekends') {\n      setSelectedDates([]);\n      setTripTime('');\n      setIsRecurring(true);\n    }\n  }, []);\n  \n  // Handle date selection\n  const handleDateSelection = useCallback((date) => {\n    if (scheduleType === 'specific_time') {\n      setSelectedDates([date]);\n    } else if (scheduleType === 'specific_dates') {\n      setSelectedDates(prev => {\n        const dateString = format(date, 'yyyy-MM-dd');\n        const exists = prev.some(d => format(new Date(d), 'yyyy-MM-dd') === dateString);\n        \n        if (exists) {\n          return prev.filter(d => format(new Date(d), 'yyyy-MM-dd') !== dateString);\n        } else {\n          return [...prev, dateString];\n        }\n      });\n    }\n  }, [scheduleType]);\n  \n  // Handle date removal\n  const removeDateSelection = useCallback((dateToRemove) => {\n    setSelectedDates(prev => \n      prev.filter(date => \n        format(new Date(date), 'yyyy-MM-dd') !== format(new Date(dateToRemove), 'yyyy-MM-dd')\n      )\n    );\n  }, []);\n  \n  // Clear all selected dates\n  const clearDateSelections = useCallback(() => {\n    setSelectedDates([]);\n  }, []);\n  \n  // Handle month selection for recurring rides\n  const handleMonthSelection = useCallback((monthString) => {\n    setScheduleMonth(monthString);\n  }, []);\n  \n  // Handle time selection\n  const handleTimeSelection = useCallback((time) => {\n    setTripTime(time);\n  }, []);\n  \n  // Validate scheduling configuration\n  const validateScheduling = useCallback(() => {\n    const errors = {};\n    \n    switch (scheduleType) {\n      case 'instant':\n        // No validation needed for instant booking\n        break;\n        \n      case 'specific_time':\n        if (selectedDates.length === 0) {\n          errors.date = 'Please select a date';\n        }\n        if (!tripTime) {\n          errors.time = 'Please select a time';\n        }\n        break;\n        \n      case 'specific_dates':\n        if (selectedDates.length === 0) {\n          errors.dates = 'Please select at least one date';\n        }\n        break;\n        \n      case 'weekdays':\n      case 'weekends':\n        if (!scheduleMonth) {\n          errors.month = 'Please select a month';\n        }\n        break;\n    }\n    \n    return {\n      isValid: Object.keys(errors).length === 0,\n      errors\n    };\n  }, [scheduleType, selectedDates, tripTime, scheduleMonth]);\n  \n  // Get scheduling summary for display\n  const schedulingSummary = useMemo(() => {\n    switch (scheduleType) {\n      case 'instant':\n        return {\n          type: 'instant',\n          display: 'Book now',\n          icon: 'âš¡',\n          details: 'Immediate booking'\n        };\n        \n      case 'specific_time':\n        if (selectedDates.length > 0 && tripTime) {\n          const date = new Date(selectedDates[0]);\n          const dateStr = format(date, 'EEE, MMM d');\n          const timeStr = format(new Date(`2000-01-01T${tripTime}`), 'h:mm a');\n          return {\n            type: 'specific_time',\n            display: `${dateStr} at ${timeStr}`,\n            icon: 'ðŸ“…',\n            details: 'Scheduled for specific date and time'\n          };\n        }\n        return {\n          type: 'specific_time',\n          display: 'Select date and time',\n          icon: 'ðŸ“…',\n          details: 'Choose when you want to travel'\n        };\n        \n      case 'specific_dates':\n        if (selectedDates.length > 0) {\n          const count = selectedDates.length;\n          return {\n            type: 'specific_dates',\n            display: `${count} selected date${count > 1 ? 's' : ''}`,\n            icon: 'ðŸ“…',\n            details: `Multiple trips on selected dates`\n          };\n        }\n        return {\n          type: 'specific_dates',\n          display: 'Select multiple dates',\n          icon: 'ðŸ“…',\n          details: 'Choose multiple travel dates'\n        };\n        \n      case 'weekdays':\n        if (scheduleMonth) {\n          const monthName = format(new Date(scheduleMonth + '-01'), 'MMMM yyyy');\n          const weekdayCount = getWeekdaysInMonth(scheduleMonth).length;\n          return {\n            type: 'weekdays',\n            display: `Weekdays in ${monthName}`,\n            icon: 'ðŸ”„',\n            details: `${weekdayCount} weekday trips`\n          };\n        }\n        return {\n          type: 'weekdays',\n          display: 'Select month for weekdays',\n          icon: 'ðŸ”„',\n          details: 'Recurring weekday trips'\n        };\n        \n      case 'weekends':\n        if (scheduleMonth) {\n          const monthName = format(new Date(scheduleMonth + '-01'), 'MMMM yyyy');\n          const weekendCount = getWeekendsInMonth(scheduleMonth).length;\n          return {\n            type: 'weekends',\n            display: `Weekends in ${monthName}`,\n            icon: 'ðŸ”„',\n            details: `${weekendCount} weekend trips`\n          };\n        }\n        return {\n          type: 'weekends',\n          display: 'Select month for weekends',\n          icon: 'ðŸ”„',\n          details: 'Recurring weekend trips'\n        };\n        \n      default:\n        return {\n          type: 'unknown',\n          display: 'Select schedule type',\n          icon: 'â“',\n          details: 'Choose how to schedule your trip'\n        };\n    }\n  }, [scheduleType, selectedDates, tripTime, scheduleMonth, getWeekdaysInMonth, getWeekendsInMonth]);\n  \n  // Get trip count\n  const tripCount = useMemo(() => {\n    switch (scheduleType) {\n      case 'instant':\n      case 'specific_time':\n        return 1;\n      case 'specific_dates':\n        return selectedDates.length;\n      case 'weekdays':\n        return scheduleMonth ? getWeekdaysInMonth(scheduleMonth).length : 0;\n      case 'weekends':\n        return scheduleMonth ? getWeekendsInMonth(scheduleMonth).length : 0;\n      default:\n        return 0;\n    }\n  }, [scheduleType, selectedDates.length, scheduleMonth, getWeekdaysInMonth, getWeekendsInMonth]);\n  \n  // Reset scheduling state\n  const resetScheduling = useCallback(() => {\n    setScheduleType(initialScheduleType);\n    setSelectedDates([]);\n    setScheduleMonth('');\n    setTripTime('');\n    setIsRecurring(false);\n  }, [initialScheduleType]);\n  \n  return {\n    // State\n    scheduleType,\n    selectedDates,\n    scheduleMonth,\n    tripTime,\n    isRecurring,\n    \n    // Computed values\n    schedulingSummary,\n    tripCount,\n    \n    // Actions\n    handleScheduleTypeChange,\n    handleDateSelection,\n    removeDateSelection,\n    clearDateSelections,\n    handleMonthSelection,\n    handleTimeSelection,\n    resetScheduling,\n    \n    // Helpers\n    getAvailableTimeSlots,\n    getAvailableDates,\n    getWeekdaysInMonth,\n    getWeekendsInMonth,\n    validateScheduling\n  };\n};\n\nexport default useScheduling;\n